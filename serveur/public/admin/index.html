<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Kiwi Bot</title>
    <meta name="description" content="Panel d'administration Kiwi TwitchBot">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/kiwi-theme.css">
    <link rel="stylesheet" href="/assets/css/kiwi-admin.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-left">
                <div class="logo">
                    <a href="https://www.twitch.tv/kiwitfb" target="_blank">
                        <img src="/assets/svg/twitch-svgrepo-com.svg"
                            alt="Twitch"
                            class="logo-icon">

                        <img src="/img/logo_gm_white.png" alt="GM Logo"
                            class="logo-gm"></a>
                </div>
            </div>
        
        <div class="navbar-center">
                <a href="/" class="nav-link">üè† Accueil</a>
                <a href="/giveaways" class="nav-link">üéÅ Giveaways</a>
                <a href="/infos" class="nav-link">‚ÑπÔ∏è + d'infos</a>
                <a href="/admin" class="nav-link active" id="admin-link">‚öôÔ∏è Panel Admin</a>
            </div>
        
        <div class="navbar-right">
            <div class="user-info">
                <img id="user-avatar" class="user-avatar" src="" alt="Avatar">
                <span id="user-name">Chargement...</span>
                <span class="admin-badge">Admin</span>
            </div>
            <button class="btn btn-outline" onclick="logout()">
                üö™ D√©connexion
            </button>
        </div>
    </nav>

    <main>
        <!-- Admin Header -->
        <div class="admin-header">
            <h1 class="page-title">‚öôÔ∏è Panel Administration</h1>
            <p class="page-subtitle">G√©rez votre bot Twitch et vos giveaways en temps r√©el</p>
        </div>

        <!-- Bot Commands Management -->
        <section class="commands-management">
            <div class="card admin-card">
                <div class="card-header">
                    <h3>ü§ñ Gestion des Commandes du Bot</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-outline btn-sm" onclick="refreshCommands()">
                            üîÑ Actualiser
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openCreateCommandModal()">
                            ‚ûï Nouvelle Commande
                        </button>
                    </div>
                </div>
                <p>Activez ou d√©sactivez les commandes du bot en temps r√©el.</p>

                <div class="commands-list" id="commands-list">
                    <p class="text-center text-secondary">Chargement des commandes...</p>
                </div>
            </div>
        </section>

        <!-- Giveaways Management -->
        <section class="giveaways-management">
            <div class="card admin-card">
                <div class="card-header">
                    <h3>üéÅ Giveaways Actifs</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-outline btn-sm" onclick="checkAutoDraw()" title="V√©rifier manuellement le syst√®me auto-draw">
                            üîÑ Tester Auto-Draw
                        </button>
                        <button class="btn btn-secondary" onclick="createGiveaway()">+ Nouveau Giveaway</button>
                    </div>
                </div>
                <p>Cr√©ez et g√©rez vos concours facilement.</p>

                <div class="giveaway-list" id="admin-giveaways-list">
                    <p class="text-center text-secondary">Chargement des giveaways...</p>
                </div>
            </div>
        </section>


    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 Kiwi Bot Panel | Developed with ‚ù§Ô∏è by <a href="https://github.com/shadowforce78" target="_blank" style="color: var(--primary); font-weight: 600; text-decoration: none;">SaumonDeLuxe</a></p>
            <div class="social-links">
                <a href="https://twitch.tv/kiwitfb" target="_blank" class="social-link" title="Twitch de Kiwi">
                    <img src="/assets/svg/twitch-svgrepo-com.svg" alt="Twitch" style="width: 24px; height: 24px;">
                </a>
                <a href="https://github.com/shadowforce78" target="_blank" class="social-link" title="GitHub du d√©veloppeur">
                    <img src="/assets/svg/github-svgrepo-com.svg" alt="GitHub" style="width: 24px; height: 24px;">
                </a>
            </div>
        </div>
    </footer>

    <!-- Create Giveaway Modal -->
    <div id="create-giveaway-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üéÅ Cr√©er un nouveau Giveaway</h3>
                <button class="modal-close" onclick="closeModal('create-giveaway-modal')">&times;</button>
            </div>
            <form id="create-giveaway-form">
                <div class="form-group">
                    <label class="form-label" for="title">Titre du Giveaway</label>
                    <input type="text" id="title" name="title" class="form-input" required placeholder="Ex: Clavier m√©canique RGB">
                </div>
                <div class="form-group">
                    <label class="form-label" for="reward">R√©compense</label>
                    <input type="text" id="reward" name="reward" class="form-input" required placeholder="Ex: Clavier Razer BlackWidow">
                </div>
                <div class="form-group">
                    <label class="form-label" for="description">Description</label>
                    <textarea id="description" name="description" class="form-textarea" placeholder="Description d√©taill√©e du giveaway..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="end_date">Date de fin</label>
                    <input type="datetime-local" id="end_date" name="end_date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="thumbnail">Miniature (URL)</label>
                    <input type="url" id="thumbnail" name="thumbnail" class="form-input" placeholder="https://exemple.com/image.jpg">
                    <small class="form-hint">URL de l'image miniature pour le giveaway (optionnel)</small>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üéÅ Cr√©er le Giveaway
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Giveaway Modal -->
    <div id="edit-giveaway-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Modifier le Giveaway</h3>
                <button class="modal-close" onclick="closeModal('edit-giveaway-modal')">&times;</button>
            </div>
            <form id="edit-giveaway-form">
                <input type="hidden" id="edit-giveaway-id" name="id">
                <div class="form-group">
                    <label class="form-label" for="edit-giveaway-title">Titre du Giveaway</label>
                    <input type="text" id="edit-giveaway-title" name="title" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-giveaway-reward">R√©compense</label>
                    <input type="text" id="edit-giveaway-reward" name="reward" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-giveaway-description">Description</label>
                    <textarea id="edit-giveaway-description" name="description" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-giveaway-end-date">Date de fin</label>
                    <input type="datetime-local" id="edit-giveaway-end-date" name="end_date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="edit-giveaway-thumbnail">Miniature (URL)</label>
                    <input type="url" id="edit-giveaway-thumbnail" name="thumbnail" class="form-input" placeholder="https://exemple.com/image.jpg">
                    <small class="form-hint">URL de l'image miniature pour le giveaway (optionnel)</small>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üíæ Sauvegarder les modifications
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Winner Modal -->
    <div id="winner-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üéâ Gagnant du Giveaway</h3>
                <button class="modal-close" onclick="closeModal('winner-modal')">&times;</button>
            </div>
            <div id="winner-content">
                <!-- Content will be filled dynamically -->
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìä R√©sultats du Giveaway</h3>
                <button class="modal-close" onclick="closeModal('results-modal')">&times;</button>
            </div>
            <div id="results-content">
                <!-- Content will be filled dynamically -->
            </div>
        </div>
    </div>

    <!-- Edit Command Modal -->
    <div id="edit-command-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Modifier la Commande</h3>
                <button class="modal-close" onclick="closeModal('edit-command-modal')">&times;</button>
            </div>
            <form id="edit-command-form" onsubmit="saveCommandContent(event)">
                <input type="hidden" id="edit-command-name">
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <p id="edit-command-description-display" style="color: var(--text-secondary); font-style: italic; margin: 0.5rem 0;"></p>
                </div>

                <div class="form-group">
                    <label class="form-label" for="edit-command-content">Contenu de la r√©ponse</label>
                    <textarea 
                        id="edit-command-content" 
                        name="content" 
                        class="form-textarea" 
                        rows="6"
                        required 
                        placeholder="Entrez le texte de r√©ponse de la commande..."></textarea>
                    <small class="form-hint">
                        üí° Variables disponibles : {user} pour le nom de l'utilisateur
                    </small>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üíæ Sauvegarder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Command Modal -->
    <div id="create-command-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Cr√©er une nouvelle commande</h3>
                <button class="modal-close" onclick="closeModal('create-command-modal')">&times;</button>
            </div>
            <form id="create-command-form" onsubmit="handleCreateCommand(event)">
                <div class="form-group">
                    <label class="form-label" for="new-command-name">Nom de la commande</label>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-weight: 600; color: var(--text-secondary);">!</span>
                        <input 
                            type="text" 
                            id="new-command-name" 
                            name="name" 
                            class="form-input" 
                            required 
                            pattern="[a-z0-9_]+"
                            placeholder="Ex: discord, twitter, regles"
                            style="flex: 1;">
                    </div>
                    <small class="form-hint">Lettres minuscules, chiffres et _ uniquement. Sans le !</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="new-command-description">Description</label>
                    <input 
                        type="text" 
                        id="new-command-description" 
                        name="description" 
                        class="form-input" 
                        required 
                        placeholder="Ex: Lien vers le Discord de la communaut√©">
                </div>

                <div class="form-group">
                    <label class="form-label" for="new-command-content">R√©ponse de la commande</label>
                    <textarea 
                        id="new-command-content" 
                        name="content" 
                        class="form-textarea" 
                        rows="4"
                        required 
                        placeholder="Ex: Rejoignez notre Discord : https://discord.gg/exemple"></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        ‚ú® Cr√©er la commande
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Command Modal -->
    <div id="edit-command-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Modifier la commande</h3>
                <button class="modal-close" onclick="closeModal('edit-command-modal')">&times;</button>
            </div>
            <form id="edit-command-form" onsubmit="handleEditCommand(event)">
                <input type="hidden" id="edit-command-name" name="name">
                
                <div class="form-group">
                    <label class="form-label">Nom de la commande</label>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-weight: 600; color: var(--text-secondary);">!</span>
                        <input 
                            type="text" 
                            id="edit-command-name-display" 
                            class="form-input" 
                            disabled
                            style="flex: 1; background: var(--bg-tertiary); cursor: not-allowed;">
                    </div>
                    <small class="form-hint">Le nom de la commande ne peut pas √™tre modifi√©</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="edit-command-description">Description</label>
                    <input 
                        type="text" 
                        id="edit-command-description" 
                        name="description" 
                        class="form-input" 
                        required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="edit-command-content">R√©ponse de la commande</label>
                    <textarea 
                        id="edit-command-content" 
                        name="content" 
                        class="form-textarea" 
                        rows="4"
                        required></textarea>
                    <small class="form-hint">
                        üí° Variables disponibles : {user} pour le nom de l'utilisateur, {channel} pour le nom de la cha√Æne
                    </small>
                </div>

                <div class="form-group" style="display: flex; gap: 0.5rem;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        üíæ Sauvegarder
                    </button>
                    <button type="button" class="btn btn-error" onclick="deleteCommand()" style="flex: 1;">
                        üóëÔ∏è Supprimer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/admin.js"></script>
</body>
</html>
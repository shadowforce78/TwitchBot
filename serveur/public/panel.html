<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Panel Bot</title>
  <link rel="stylesheet" href="/css/common.css" />
  <link rel="stylesheet" href="/css/panel.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; background:#111; color:#eee; }
    header { display:flex; align-items:center; gap:1rem; }
    img.pdp { width:48px; height:48px; border-radius:50%; }
    .cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap:1rem; margin-top:1.5rem; }
    .card { background:#1e1e1e; border:1px solid #333; border-radius:8px; padding:1rem; }
    button { cursor:pointer; }
  </style>
  <script defer src="/js/panel.js"></script>
</head>
<body>
  <header>
    <div id="userInfo">Chargement...</div>
    <form method="post" action="/logout"><button type="submit">Logout</button></form>
  </header>
  <h1>Panel de gestion du bot</h1>
  <p>Réservé aux modérateurs/broadcaster de la chaîne.</p>

  <div class="cards">
    <div class="card">
      <h3>Statut</h3>
      <p id="botStatus">En ligne</p>
    </div>
    <div class="card">
      <h3>Envoyer un message</h3>
      <input type="text" id="msgInput" placeholder="Votre message" style="width:100%;" />
      <button id="sendBtn" style="margin-top:.5rem;">Envoyer</button>
      <div id="sendResult" style="margin-top:.5rem;font-size:.85rem;"></div>
    </div>
    <div class="card">
      <h3>Commandes</h3>
      <div id="commands-panel" style="font-size:.95rem;"></div>
    </div>
  </div>
  <script>
    fetch('/api/commands')
      .then(res => res.json())
      .then(commands => {
        function renderPanel() {
          const panel = document.getElementById('commands-panel');
          panel.innerHTML = '';
          commands.forEach(cmd => {
            const box = document.createElement('div');
            box.className = 'command-box';
            box.innerHTML = `
              <h3>${cmd.name}</h3>
              <p>${cmd.description || ''}</p>
              <span style="font-size:.85em;color:#747474;">Type: ${cmd.type}</span>
              ${cmd.type === 'basic' ? `<textarea class=\"cmd-content\">${cmd.content || ''}</textarea>` : ''}
              <label class=\"switch\">
                <input type=\"checkbox\" ${cmd.enabled ? 'checked' : ''} class=\"cmd-switch\">
                <span class=\"slider\"></span> Actif
              </label>
            `;
            // Switch on/off
            box.querySelector('.cmd-switch').onchange = e => {
              cmd.enabled = e.target.checked;
              // TODO: appel API pour sauvegarder
            };
            // Content modifiable
            if (cmd.type === 'basic') {
              box.querySelector('.cmd-content').oninput = e => {
                cmd.content = e.target.value;
                // TODO: appel API pour sauvegarder
              };
            }
            panel.appendChild(box);
          });
        }
        renderPanel();
      });
  </script>
</body>
</html>
